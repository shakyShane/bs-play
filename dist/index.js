"use strict";
var Rx = require("rx");
var connect = require("connect");
var serve = require("serve-static");
var bindHttp_1 = require("./effects/bindHttp");
var dir_1 = require("./reads/dir$");
function getServeStatic(dir, options) {
    return { route: '/', dir: dir, options: options };
}
var log = function (name) { return function (x) { return console.log('-->', name, x); }; };
function bs(config, reads, effects) {
    var $dirs = dir_1.default(config.serveStatic, { cwd: './' });
    var ss$ = reads.dir$.map(function (dir) { return getServeStatic(dir, {}); });
    var server = reads
        .port$
        .zip(ss$.toArray(), function (port, ss) { return ({ port: port, ss: ss }); })
        .flatMap(function (incoming) {
        var app = connect();
        incoming.ss.forEach(function (ss) { return app.use('/', serve(ss.dir, ss.options)); });
        return effects.bindHttp(app, incoming.port);
    });
    return Rx.Observable.concat(server);
}
var sub = bs({
    serveStatic: './'
}, {
    port$: Rx.Observable.of(3000),
    dir$: Rx.Observable.of('/Users/shakyshane/sites/oss/bs-play/fixtures')
}, { bindHttp: bindHttp_1.default })
    .subscribe(function (x) { return console.log(x.address()); });
// setTimeout(() => sub.dispose(), 5000);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHVCQUErQjtBQUMvQixpQ0FBb0M7QUFDcEMsb0NBQXlDO0FBQ3pDLCtDQUEwQztBQUMxQyxvQ0FBb0M7QUEwQnBDLHdCQUF3QixHQUFHLEVBQUUsT0FBTztJQUNoQyxNQUFNLENBQUMsRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsS0FBQSxFQUFFLE9BQU8sU0FBQSxFQUFDLENBQUM7QUFDdEMsQ0FBQztBQUVELElBQU0sR0FBRyxHQUFHLFVBQUMsSUFBSSxJQUFLLE9BQUEsVUFBQyxDQUFDLElBQUssT0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQTNCLENBQTJCLEVBQWxDLENBQWtDLENBQUM7QUFFekQsWUFBWSxNQUFnQixFQUFFLEtBQVksRUFBRSxPQUFnQjtJQUV4RCxJQUFNLEtBQUssR0FBSSxhQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxFQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0lBQ3hELElBQU0sR0FBRyxHQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsY0FBYyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBdkIsQ0FBdUIsQ0FBQyxDQUFDO0lBQzlELElBQU0sTUFBTSxHQUFHLEtBQUs7U0FDZixLQUFLO1NBQ0wsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsRUFBRSxVQUFDLElBQUksRUFBRSxFQUFFLElBQUssT0FBQSxDQUFDLEVBQUMsSUFBSSxNQUFBLEVBQUUsRUFBRSxJQUFBLEVBQUMsQ0FBQyxFQUFaLENBQVksQ0FBQztTQUU5QyxPQUFPLENBQUMsVUFBQSxRQUFRO1FBQ2IsSUFBTSxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUM7UUFDdEIsUUFBUSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFlLElBQUssT0FBQSxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBdkMsQ0FBdUMsQ0FBQyxDQUFDO1FBQ2xGLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEQsQ0FBQyxDQUFDLENBQUM7SUFFUCxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUdELElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FDVjtJQUNJLFdBQVcsRUFBRSxJQUFJO0NBQ3BCLEVBQ0Q7SUFDSSxLQUFLLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO0lBQzdCLElBQUksRUFBRyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyw4Q0FBOEMsQ0FBQztDQUMxRSxFQUNELEVBQUMsUUFBUSxvQkFBQSxFQUFDLENBQ1Q7S0FDQSxTQUFTLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUF4QixDQUF3QixDQUFDLENBQUM7QUFFOUMseUNBQXlDIn0=